{"query":{"bool":{"must":[{"match":{"device":"reflowoven"}},{"match":{"state":1}}],"filter":{"range":{"timestamp":{"gte":"now-60m"}}}}},"_source":["energy","working_time"],"script_fields":{"power":{"script":{"lang":"painless","source":"doc['energy'].value*3600000 / doc['working_time'].value"}}},"aggs":{"reflowoven_maintain_delay":{"avg":{"field":"working_time"}},"reflowoven_maintain_energy":{"avg":{"field":"energy"}},"reflowoven_maintain_power":{"avg":{"script":{"source":"doc['energy'].value*3600000 / doc['working_time'].value"}}}}}