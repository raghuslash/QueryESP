{"query":{"bool":{"must":[{"match":{"device":"reflowoven"}},{"match":{"state":0}}],"filter":{"range":{"timestamp":{"gte":"now-2d"}}}}},"_source":["energy","working_time"],"script_fields":{"power":{"script":{"lang":"painless","source":"doc['energy'].value*3600000 / doc['working_time'].value"}}},"aggs":{"reflowoven_off_delay":{"avg":{"field":"working_time"}},"reflowoven_off_energy":{"avg":{"field":"energy"}},"reflowoven_off_power":{"avg":{"script":{"source":"doc['energy'].value*3600000 / doc['working_time'].value"}}}}}
